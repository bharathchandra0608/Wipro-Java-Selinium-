package JDBC;

import java.sql.*;
import java.util.Scanner;

public class HospitalPatientManager {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);

        try {
            // Load JDBC driver
            Class.forName("com.mysql.cj.jdbc.Driver");

            // Connect to MySQL database
            Connection con = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/hospital", "root", "Patel@0608"
            );
            System.out.println("✅ Connected to hospital database");

            // Create table if not exists
            String createTableSQL = "CREATE TABLE IF NOT EXISTS patients ("
                    + "id INT PRIMARY KEY AUTO_INCREMENT, "
                    + "name VARCHAR(100), "
                    + "age INT, "
                    + "disease VARCHAR(100), "
                    + "admission_date DATE, "
                    + "doctor_assigned VARCHAR(100))";

            Statement stmt = con.createStatement();
            stmt.executeUpdate(createTableSQL);

            // Input patient data
            System.out.print("Enter Patient Name: ");
            String name = sc.nextLine();

            System.out.print("Enter Age: ");
            int age = sc.nextInt();
            sc.nextLine();  // consume leftover newline

            System.out.print("Enter Disease: ");
            String disease = sc.nextLine();

            System.out.print("Enter Admission Date (YYYY-MM-DD): ");
            String admissionDate = sc.nextLine();

            System.out.print("Enter Doctor Assigned: ");
            String doctor = sc.nextLine();

            // Insert data using PreparedStatement
            String insertSQL = "INSERT INTO patients(name, age, disease, admission_date, doctor_assigned) "
                             + "VALUES (?, ?, ?, ?, ?)";

            PreparedStatement pstmt = con.prepareStatement(insertSQL);
            pstmt.setString(1, name);
            pstmt.setInt(2, age);
            pstmt.setString(3, disease);
            pstmt.setDate(4, Date.valueOf(admissionDate));  // converts string to java.sql.Date
            pstmt.setString(5, doctor);

            int rowsInserted = pstmt.executeUpdate();

            if (rowsInserted > 0) {
                System.out.println("✅ Patient registered successfully!");
            }

            // Close resources
            pstmt.close();
            stmt.close();
            con.close();

        } catch (Exception e) {
            e.printStackTrace();
        }

        sc.close();
    }
}
